<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AutoMarket ‚Äî Flutter + Supabase Architecture Guide</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #111118;
    --surface2: #1a1a26;
    --border: #252535;
    --accent: #f0b429;
    --accent2: #7c5cbf;
    --accent3: #2dd4bf;
    --text: #e8e8f0;
    --muted: #6b6b85;
    --green: #22c55e;
    --red: #ef4444;
    --blue: #3b82f6;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-weight: 300;
    line-height: 1.6;
    min-height: 100vh;
  }

  /* HEADER */
  header {
    border-bottom: 1px solid var(--border);
    padding: 2rem 3rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    position: sticky;
    top: 0;
    background: rgba(10,10,15,0.95);
    backdrop-filter: blur(12px);
    z-index: 100;
  }
  .logo {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 1.4rem;
    letter-spacing: -0.02em;
  }
  .logo span { color: var(--accent); }
  nav { display: flex; gap: 0.25rem; margin-left: auto; flex-wrap: wrap; }
  nav a {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--muted);
    text-decoration: none;
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    transition: all 0.2s;
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }
  nav a:hover { color: var(--accent); background: rgba(240,180,41,0.08); }

  /* LAYOUT */
  .container { max-width: 1100px; margin: 0 auto; padding: 0 2rem; }

  /* HERO */
  .hero {
    padding: 5rem 3rem 3rem;
    max-width: 1100px;
    margin: 0 auto;
  }
  .hero-tag {
    display: inline-block;
    background: rgba(240,180,41,0.1);
    border: 1px solid rgba(240,180,41,0.3);
    color: var(--accent);
    font-size: 0.75rem;
    font-weight: 500;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.3rem 0.8rem;
    border-radius: 100px;
    margin-bottom: 1.5rem;
  }
  .hero h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(2.2rem, 5vw, 3.8rem);
    font-weight: 800;
    line-height: 1.1;
    letter-spacing: -0.03em;
    margin-bottom: 1rem;
  }
  .hero h1 em { font-style: normal; color: var(--accent); }
  .hero p { color: var(--muted); font-size: 1.05rem; max-width: 600px; }

  /* TECH STACK BADGES */
  .stack { display: flex; gap: 0.75rem; margin-top: 2rem; flex-wrap: wrap; }
  .badge {
    display: flex; align-items: center; gap: 0.5rem;
    background: var(--surface); border: 1px solid var(--border);
    padding: 0.45rem 1rem; border-radius: 8px;
    font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;
  }
  .badge-dot { width: 7px; height: 7px; border-radius: 50%; }
  .dot-flutter { background: #54c5f8; }
  .dot-supabase { background: #3ecf8e; }
  .dot-stripe { background: #7c5cbf; }
  .dot-dart { background: #f0b429; }

  /* SECTION */
  section {
    padding: 4rem 0;
    border-top: 1px solid var(--border);
  }
  .section-header {
    max-width: 1100px;
    margin: 0 auto 2.5rem;
    padding: 0 2rem;
    display: flex;
    align-items: flex-start;
    gap: 1.5rem;
  }
  .section-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--accent);
    background: rgba(240,180,41,0.1);
    border: 1px solid rgba(240,180,41,0.25);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    margin-top: 0.4rem;
    white-space: nowrap;
  }
  .section-header h2 {
    font-family: 'Syne', sans-serif;
    font-size: 1.8rem;
    font-weight: 700;
    letter-spacing: -0.02em;
  }
  .section-header p { color: var(--muted); margin-top: 0.4rem; font-size: 0.95rem; }

  /* RELATIONSHIP DIAGRAM */
  .diagram-grid {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 2rem;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }
  .entity-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .entity-card:hover { border-color: var(--accent2); }
  .entity-header {
    padding: 0.75rem 1rem;
    display: flex; align-items: center; gap: 0.6rem;
    border-bottom: 1px solid var(--border);
  }
  .entity-icon { font-size: 1.1rem; }
  .entity-name {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    letter-spacing: 0.02em;
  }
  .entity-type {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--muted);
    margin-left: auto;
    background: var(--surface2);
    padding: 0.1rem 0.4rem;
    border-radius: 3px;
  }
  .entity-fields { padding: 0.75rem 1rem; }
  .field {
    display: flex; align-items: center; gap: 0.6rem;
    padding: 0.2rem 0;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
  }
  .field-key { color: var(--accent); font-weight: 500; min-width: 16px; }
  .field-name { color: var(--text); flex: 1; }
  .field-type { color: var(--muted); }
  .field-pk { color: #ef4444; }
  .field-fk { color: #3b82f6; }
  .field-unique { color: var(--accent3); }

  /* RELATIONSHIP ARROWS */
  .rel-map {
    max-width: 1100px;
    margin: 2rem auto 0;
    padding: 0 2rem;
  }
  .rel-item {
    display: flex; align-items: center; gap: 1rem;
    padding: 0.6rem 1rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 0.5rem;
    font-size: 0.85rem;
  }
  .rel-from { font-family: 'Syne', sans-serif; font-weight: 700; color: var(--accent); }
  .rel-arrow { color: var(--muted); font-family: 'JetBrains Mono', monospace; }
  .rel-to { font-family: 'Syne', sans-serif; font-weight: 700; color: var(--accent2); }
  .rel-label { color: var(--muted); font-size: 0.78rem; margin-left: auto; }
  .rel-type {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    padding: 0.15rem 0.5rem;
    border-radius: 4px;
    background: rgba(124,92,191,0.15);
    color: var(--accent2);
    border: 1px solid rgba(124,92,191,0.3);
  }

  /* STEPS */
  .steps-grid {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 2rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }
  .step-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }
  .step-card-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: 0.75rem;
  }
  .step-num {
    width: 28px; height: 28px;
    border-radius: 50%;
    background: var(--accent);
    color: #000;
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 0.8rem;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .step-card-header h3 {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 0.95rem;
  }
  .step-card-body { padding: 1.25rem; }
  .step-card-body p { color: var(--muted); font-size: 0.88rem; margin-bottom: 1rem; }

  /* CODE BLOCKS */
  .code-block {
    background: #0d0d15;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    margin: 0.75rem 0;
  }
  .code-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 0.5rem 0.75rem;
    border-bottom: 1px solid var(--border);
    background: var(--surface2);
  }
  .code-lang {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }
  .copy-btn {
    background: none; border: none; cursor: pointer;
    color: var(--muted); font-size: 0.75rem; font-family: 'Outfit', sans-serif;
    padding: 0.2rem 0.4rem; border-radius: 4px;
    transition: color 0.2s;
  }
  .copy-btn:hover { color: var(--accent); }
  pre {
    padding: 1rem;
    overflow-x: auto;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    line-height: 1.7;
    color: #c9d1d9;
  }
  .kw { color: #ff7b72; }
  .str { color: #a5d6ff; }
  .cmt { color: #6e7681; font-style: italic; }
  .fn { color: #d2a8ff; }
  .num { color: #f8c555; }
  .type { color: #79c0ff; }
  .var { color: #e8e8f0; }

  /* FLOW DIAGRAM */
  .flow {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 2rem;
  }
  .flow-row {
    display: flex;
    align-items: stretch;
    gap: 0;
    margin-bottom: 0.5rem;
  }
  .flow-node {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1rem 1.25rem;
    position: relative;
  }
  .flow-node h4 {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    margin-bottom: 0.35rem;
  }
  .flow-node p { color: var(--muted); font-size: 0.82rem; }
  .flow-connector {
    display: flex; align-items: center; justify-content: center;
    padding: 0 0.5rem;
    color: var(--accent);
    font-size: 1.2rem;
  }
  .flow-amount {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    margin-top: 0.4rem;
  }
  .amount-green { color: var(--green); }
  .amount-red { color: var(--red); }
  .amount-yellow { color: var(--accent); }

  /* SUBSCRIPTION TABLE */
  .sub-grid {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 2rem;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }
  .sub-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    transition: transform 0.2s, border-color 0.2s;
  }
  .sub-card:hover { transform: translateY(-3px); border-color: var(--accent); }
  .sub-card.popular { border-color: var(--accent); }
  .sub-card-header { padding: 1.25rem; border-bottom: 1px solid var(--border); }
  .sub-plan {
    font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1rem;
    margin-bottom: 0.25rem;
  }
  .sub-price {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.5rem;
    color: var(--accent);
    font-weight: 500;
  }
  .sub-period { color: var(--muted); font-size: 0.8rem; }
  .popular-badge {
    display: inline-block;
    background: var(--accent);
    color: #000;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 0.15rem 0.5rem;
    border-radius: 100px;
    margin-bottom: 0.5rem;
  }
  .sub-features { padding: 1.25rem; }
  .sub-feature {
    display: flex; align-items: center; gap: 0.5rem;
    font-size: 0.83rem; color: var(--muted);
    padding: 0.3rem 0;
  }
  .sub-feature .check { color: var(--green); }
  .sub-feature .x { color: var(--red); }

  /* ARCHITECTURE OVERVIEW */
  .arch-row {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 2rem;
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 1rem;
  }
  .arch-layer {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1.25rem;
  }
  .arch-layer-title {
    font-family: 'Syne', sans-serif;
    font-weight: 700; font-size: 0.85rem;
    margin-bottom: 0.75rem;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }
  .arch-item {
    display: flex; align-items: center; gap: 0.5rem;
    font-size: 0.82rem; color: var(--muted);
    padding: 0.25rem 0;
    border-bottom: 1px solid var(--border);
  }
  .arch-item:last-child { border-bottom: none; }
  .arch-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent2); flex-shrink: 0; }

  /* FULL WIDTH STEPS */
  .impl-steps {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 2rem;
  }
  .impl-step {
    display: grid;
    grid-template-columns: 48px 1fr;
    gap: 1.5rem;
    margin-bottom: 2rem;
    position: relative;
  }
  .impl-step::before {
    content: '';
    position: absolute;
    left: 23px;
    top: 48px;
    bottom: -2rem;
    width: 2px;
    background: var(--border);
  }
  .impl-step:last-child::before { display: none; }
  .impl-step-num {
    width: 48px; height: 48px;
    border-radius: 50%;
    background: var(--surface2);
    border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 1rem;
    color: var(--accent);
    flex-shrink: 0;
    z-index: 1;
  }
  .impl-step-content h3 {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 0.4rem;
    padding-top: 0.6rem;
  }
  .impl-step-content p { color: var(--muted); font-size: 0.88rem; margin-bottom: 0.75rem; }

  /* TABS */
  .tabs { display: flex; gap: 0.3rem; margin-bottom: 1rem; flex-wrap: wrap; }
  .tab {
    background: var(--surface2); border: 1px solid var(--border);
    color: var(--muted); font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem; padding: 0.3rem 0.7rem; border-radius: 6px;
    cursor: pointer; transition: all 0.2s;
  }
  .tab.active { background: rgba(240,180,41,0.1); border-color: rgba(240,180,41,0.4); color: var(--accent); }

  /* ALERT BOXES */
  .alert {
    padding: 0.85rem 1rem;
    border-radius: 8px;
    font-size: 0.85rem;
    margin: 0.75rem 0;
    border-left: 3px solid;
  }
  .alert-info { background: rgba(59,130,246,0.08); border-color: var(--blue); color: #93c5fd; }
  .alert-warn { background: rgba(240,180,41,0.08); border-color: var(--accent); color: #fcd34d; }
  .alert-success { background: rgba(34,197,94,0.08); border-color: var(--green); color: #86efac; }

  footer {
    border-top: 1px solid var(--border);
    padding: 2rem 3rem;
    text-align: center;
    color: var(--muted);
    font-size: 0.8rem;
  }

  @media (max-width: 768px) {
    header { padding: 1rem 1.5rem; }
    .hero { padding: 3rem 1.5rem 2rem; }
    .diagram-grid, .steps-grid, .sub-grid, .arch-row { grid-template-columns: 1fr; }
    nav a { font-size: 0.7rem; padding: 0.3rem 0.5rem; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">Auto<span>Market</span></div>
  <nav>
    <a href="#schema">Schema</a>
    <a href="#relationships">Relations</a>
    <a href="#communication">Chat</a>
    <a href="#revenue">Revenue</a>
    <a href="#subscriptions">Subscriptions</a>
    <a href="#implementation">Implementation</a>
  </nav>
</header>

<div class="hero">
  <div class="hero-tag">Architecture Guide</div>
  <h1>Flutter + Supabase<br><em>Car Marketplace</em></h1>
  <p>Complete step-by-step guide: database schema, entity relationships, real-time chat, dealer subscriptions, and owner revenue commission system.</p>
  <div class="stack">
    <div class="badge"><div class="badge-dot dot-flutter"></div>Flutter</div>
    <div class="badge"><div class="badge-dot dot-supabase"></div>Supabase</div>
    <div class="badge"><div class="badge-dot dot-stripe"></div>Stripe</div>
    <div class="badge"><div class="badge-dot dot-dart"></div>Dart</div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ SECTION 1: DATABASE SCHEMA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section id="schema">
  <div class="section-header">
    <div class="section-num">01</div>
    <div>
      <h2>Database Schema</h2>
      <p>All Supabase tables and their fields with types and key constraints</p>
    </div>
  </div>

  <div class="diagram-grid">

    <!-- USERS -->
    <div class="entity-card">
      <div class="entity-header">
        <span class="entity-icon">üë§</span>
        <span class="entity-name">profiles</span>
        <span class="entity-type">TABLE</span>
      </div>
      <div class="entity-fields">
        <div class="field"><span class="field-key field-pk">PK</span><span class="field-name">id</span><span class="field-type">uuid</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">full_name</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">email</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">phone</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">avatar_url</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">role</span><span class="field-type">enum(customer,dealer,admin)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">created_at</span><span class="field-type">timestamptz</span></div>
      </div>
    </div>

    <!-- DEALERS -->
    <div class="entity-card">
      <div class="entity-header">
        <span class="entity-icon">üè™</span>
        <span class="entity-name">dealers</span>
        <span class="entity-type">TABLE</span>
      </div>
      <div class="entity-fields">
        <div class="field"><span class="field-key field-pk">PK</span><span class="field-name">id</span><span class="field-type">uuid</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">profile_id</span><span class="field-type">‚Üí profiles</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">business_name</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">license_number</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">address</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">location</span><span class="field-type">point</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">is_verified</span><span class="field-type">bool</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">commission_rate</span><span class="field-type">numeric(5,2)</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">subscription_id</span><span class="field-type">‚Üí subscriptions</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">stripe_account_id</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">rating</span><span class="field-type">numeric(3,2)</span></div>
      </div>
    </div>

    <!-- CARS -->
    <div class="entity-card">
      <div class="entity-header">
        <span class="entity-icon">üöó</span>
        <span class="entity-name">cars</span>
        <span class="entity-type">TABLE</span>
      </div>
      <div class="entity-fields">
        <div class="field"><span class="field-key field-pk">PK</span><span class="field-name">id</span><span class="field-type">uuid</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">dealer_id</span><span class="field-type">‚Üí dealers</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">make</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">model</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">year</span><span class="field-type">int</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">price</span><span class="field-type">numeric(12,2)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">mileage</span><span class="field-type">int</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">condition</span><span class="field-type">enum(new,used)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">status</span><span class="field-type">enum(available,sold,reserved)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">images</span><span class="field-type">text[]</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">specs</span><span class="field-type">jsonb</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">description</span><span class="field-type">text</span></div>
      </div>
    </div>

    <!-- CONVERSATIONS -->
    <div class="entity-card">
      <div class="entity-header">
        <span class="entity-icon">üí¨</span>
        <span class="entity-name">conversations</span>
        <span class="entity-type">TABLE</span>
      </div>
      <div class="entity-fields">
        <div class="field"><span class="field-key field-pk">PK</span><span class="field-name">id</span><span class="field-type">uuid</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">customer_id</span><span class="field-type">‚Üí profiles</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">dealer_id</span><span class="field-type">‚Üí dealers</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">car_id</span><span class="field-type">‚Üí cars</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">last_message_at</span><span class="field-type">timestamptz</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">status</span><span class="field-type">enum(active,closed)</span></div>
      </div>
    </div>

    <!-- MESSAGES -->
    <div class="entity-card">
      <div class="entity-header">
        <span class="entity-icon">üì®</span>
        <span class="entity-name">messages</span>
        <span class="entity-type">TABLE</span>
      </div>
      <div class="entity-fields">
        <div class="field"><span class="field-key field-pk">PK</span><span class="field-name">id</span><span class="field-type">uuid</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">conversation_id</span><span class="field-type">‚Üí conversations</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">sender_id</span><span class="field-type">‚Üí profiles</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">content</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">type</span><span class="field-type">enum(text,image,offer)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">is_read</span><span class="field-type">bool</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">metadata</span><span class="field-type">jsonb</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">created_at</span><span class="field-type">timestamptz</span></div>
      </div>
    </div>

    <!-- TRANSACTIONS -->
    <div class="entity-card">
      <div class="entity-header">
        <span class="entity-icon">üí∞</span>
        <span class="entity-name">transactions</span>
        <span class="entity-type">TABLE</span>
      </div>
      <div class="entity-fields">
        <div class="field"><span class="field-key field-pk">PK</span><span class="field-name">id</span><span class="field-name">uuid</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">car_id</span><span class="field-type">‚Üí cars</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">buyer_id</span><span class="field-type">‚Üí profiles</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">dealer_id</span><span class="field-type">‚Üí dealers</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">sale_price</span><span class="field-type">numeric(12,2)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">platform_fee</span><span class="field-type">numeric(12,2)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">dealer_payout</span><span class="field-type">numeric(12,2)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">stripe_transfer_id</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">status</span><span class="field-type">enum(pending,completed,refunded)</span></div>
      </div>
    </div>

    <!-- SUBSCRIPTIONS -->
    <div class="entity-card">
      <div class="entity-header">
        <span class="entity-icon">üìÖ</span>
        <span class="entity-name">subscription_plans</span>
        <span class="entity-type">TABLE</span>
      </div>
      <div class="entity-fields">
        <div class="field"><span class="field-key field-pk">PK</span><span class="field-name">id</span><span class="field-type">uuid</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">name</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">interval</span><span class="field-type">enum(monthly,yearly)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">price</span><span class="field-type">numeric(10,2)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">max_listings</span><span class="field-type">int</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">commission_rate</span><span class="field-type">numeric(5,2)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">stripe_price_id</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">features</span><span class="field-type">jsonb</span></div>
      </div>
    </div>

    <!-- DEALER SUBSCRIPTIONS -->
    <div class="entity-card">
      <div class="entity-header">
        <span class="entity-icon">üîÑ</span>
        <span class="entity-name">dealer_subscriptions</span>
        <span class="entity-type">TABLE</span>
      </div>
      <div class="entity-fields">
        <div class="field"><span class="field-key field-pk">PK</span><span class="field-name">id</span><span class="field-type">uuid</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">dealer_id</span><span class="field-type">‚Üí dealers</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">plan_id</span><span class="field-type">‚Üí subscription_plans</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">stripe_sub_id</span><span class="field-type">text</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">status</span><span class="field-type">enum(active,past_due,canceled)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">current_period_end</span><span class="field-type">timestamptz</span></div>
      </div>
    </div>

    <!-- REVIEWS -->
    <div class="entity-card">
      <div class="entity-header">
        <span class="entity-icon">‚≠ê</span>
        <span class="entity-name">reviews</span>
        <span class="entity-type">TABLE</span>
      </div>
      <div class="entity-fields">
        <div class="field"><span class="field-key field-pk">PK</span><span class="field-name">id</span><span class="field-type">uuid</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">transaction_id</span><span class="field-type">‚Üí transactions</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">reviewer_id</span><span class="field-type">‚Üí profiles</span></div>
        <div class="field"><span class="field-key field-fk">FK</span><span class="field-name">dealer_id</span><span class="field-type">‚Üí dealers</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">rating</span><span class="field-type">int (1‚Äì5)</span></div>
        <div class="field"><span class="field-key">¬∑</span><span class="field-name">comment</span><span class="field-type">text</span></div>
      </div>
    </div>

  </div><!-- end diagram-grid -->
</section>

<!-- ‚îÄ‚îÄ‚îÄ SECTION 2: RELATIONSHIPS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section id="relationships">
  <div class="section-header">
    <div class="section-num">02</div>
    <div>
      <h2>Entity Relationships</h2>
      <p>How all tables connect to each other</p>
    </div>
  </div>
  <div class="rel-map">
    <div class="rel-item"><span class="rel-from">profiles</span><span class="rel-arrow">‚îÄ‚îÄ1:1‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">dealers</span><span class="rel-type">ONE-TO-ONE</span><span class="rel-label">A dealer has one profile (extended info)</span></div>
    <div class="rel-item"><span class="rel-from">dealers</span><span class="rel-arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">cars</span><span class="rel-type">ONE-TO-MANY</span><span class="rel-label">One dealer lists many cars</span></div>
    <div class="rel-item"><span class="rel-from">profiles (customer)</span><span class="rel-arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">conversations</span><span class="rel-type">ONE-TO-MANY</span><span class="rel-label">Customer starts many conversations</span></div>
    <div class="rel-item"><span class="rel-from">dealers</span><span class="rel-arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">conversations</span><span class="rel-type">ONE-TO-MANY</span><span class="rel-label">Dealer is in many conversations</span></div>
    <div class="rel-item"><span class="rel-from">cars</span><span class="rel-arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">conversations</span><span class="rel-type">ONE-TO-MANY</span><span class="rel-label">Each car can have multiple inquiries</span></div>
    <div class="rel-item"><span class="rel-from">conversations</span><span class="rel-arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">messages</span><span class="rel-type">ONE-TO-MANY</span><span class="rel-label">A conversation has many messages</span></div>
    <div class="rel-item"><span class="rel-from">cars</span><span class="rel-arrow">‚îÄ‚îÄ1:1‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">transactions</span><span class="rel-type">ONE-TO-ONE</span><span class="rel-label">A car has at most one completed sale</span></div>
    <div class="rel-item"><span class="rel-from">subscription_plans</span><span class="rel-arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">dealer_subscriptions</span><span class="rel-type">ONE-TO-MANY</span><span class="rel-label">Many dealers can be on the same plan</span></div>
    <div class="rel-item"><span class="rel-from">dealers</span><span class="rel-arrow">‚îÄ‚îÄ1:1‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">dealer_subscriptions</span><span class="rel-type">ONE-TO-ONE</span><span class="rel-label">A dealer has one active subscription</span></div>
    <div class="rel-item"><span class="rel-from">transactions</span><span class="rel-arrow">‚îÄ‚îÄ1:1‚îÄ‚îÄ‚ñ∂</span><span class="rel-to">reviews</span><span class="rel-type">ONE-TO-ONE</span><span class="rel-label">One review per completed transaction</span></div>
  </div>
</section>

<!-- ‚îÄ‚îÄ‚îÄ SECTION 3: COMMUNICATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section id="communication">
  <div class="section-header">
    <div class="section-num">03</div>
    <div>
      <h2>Real-Time Communication</h2>
      <p>How customers and dealers communicate using Supabase Realtime</p>
    </div>
  </div>

  <div class="steps-grid container">
    <div class="step-card">
      <div class="step-card-header">
        <div class="step-num">1</div>
        <h3>Create Conversation</h3>
      </div>
      <div class="step-card-body">
        <p>Customer taps "Contact Dealer" on a car listing. App checks for existing conversation on that car, creates one if none exists.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">dart</span></div>
          <pre><span class="cmt">// lib/services/chat_service.dart</span>
<span class="kw">Future</span>&lt;<span class="type">String</span>&gt; getOrCreateConversation({
  <span class="kw">required</span> <span class="type">String</span> customerId,
  <span class="kw">required</span> <span class="type">String</span> dealerId,
  <span class="kw">required</span> <span class="type">String</span> carId,
}) <span class="kw">async</span> {
  <span class="kw">final</span> existing = <span class="kw">await</span> supabase
    .from(<span class="str">'conversations'</span>)
    .select(<span class="str">'id'</span>)
    .eq(<span class="str">'customer_id'</span>, customerId)
    .eq(<span class="str">'car_id'</span>, carId)
    .maybeSingle();

  <span class="kw">if</span> (existing != <span class="kw">null</span>) <span class="kw">return</span> existing[<span class="str">'id'</span>];

  <span class="kw">final</span> newConv = <span class="kw">await</span> supabase
    .from(<span class="str">'conversations'</span>)
    .insert({
      <span class="str">'customer_id'</span>: customerId,
      <span class="str">'dealer_id'</span>: dealerId,
      <span class="str">'car_id'</span>: carId,
    })
    .select(<span class="str">'id'</span>)
    .single();

  <span class="kw">return</span> newConv[<span class="str">'id'</span>];
}</pre>
        </div>
      </div>
    </div>

    <div class="step-card">
      <div class="step-card-header">
        <div class="step-num">2</div>
        <h3>Subscribe to Realtime</h3>
      </div>
      <div class="step-card-body">
        <p>Subscribe to the messages channel for a conversation. Messages appear instantly for both parties using Supabase Realtime.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">dart</span></div>
          <pre><span class="cmt">// In your ChatScreen widget</span>
<span class="kw">late final</span> RealtimeChannel _channel;

<span class="kw">void</span> <span class="fn">_subscribeToMessages</span>() {
  _channel = supabase
    .channel(<span class="str">'conv_</span><span class="var">$conversationId</span><span class="str">'</span>)
    .onPostgresChanges(
      event: PostgresChangeEvent.insert,
      schema: <span class="str">'public'</span>,
      table: <span class="str">'messages'</span>,
      filter: PostgresChangeFilter(
        type: PostgresChangeFilterType.eq,
        column: <span class="str">'conversation_id'</span>,
        value: conversationId,
      ),
      callback: (payload) {
        setState(() => _messages.add(
          Message.fromMap(payload.newRecord)
        ));
      },
    )
    .subscribe();
}

<span class="cmt">// Dispose when leaving</span>
<span class="kw">void</span> dispose() {
  supabase.removeChannel(_channel);
  <span class="kw">super</span>.dispose();
}</pre>
        </div>
      </div>
    </div>

    <div class="step-card">
      <div class="step-card-header">
        <div class="step-num">3</div>
        <h3>Send Messages & Offers</h3>
      </div>
      <div class="step-card-body">
        <p>Customers can send text, images, or price offers. The <code>metadata</code> field stores offer amounts for negotiation.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">dart</span></div>
          <pre><span class="kw">Future</span>&lt;<span class="kw">void</span>&gt; <span class="fn">sendOffer</span>(<span class="type">double</span> offerAmount) <span class="kw">async</span> {
  <span class="kw">await</span> supabase.from(<span class="str">'messages'</span>).insert({
    <span class="str">'conversation_id'</span>: conversationId,
    <span class="str">'sender_id'</span>: currentUserId,
    <span class="str">'content'</span>: <span class="str">'I would like to offer </span><span class="var">$offerAmount</span><span class="str">'</span>,
    <span class="str">'type'</span>: <span class="str">'offer'</span>,
    <span class="str">'metadata'</span>: {<span class="str">'amount'</span>: offerAmount, <span class="str">'status'</span>: <span class="str">'pending'</span>},
  });
}</pre>
        </div>
      </div>
    </div>

    <div class="step-card">
      <div class="step-card-header">
        <div class="step-num">4</div>
        <h3>Row Level Security (RLS)</h3>
      </div>
      <div class="step-card-body">
        <p>Enforce security with RLS so users can only see their own conversations. Add these policies in Supabase SQL Editor.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">sql</span></div>
          <pre><span class="cmt">-- Only conversation participants can see messages</span>
<span class="kw">CREATE POLICY</span> <span class="str">"message_access"</span>
<span class="kw">ON</span> messages <span class="kw">FOR ALL USING</span> (
  conversation_id <span class="kw">IN</span> (
    <span class="kw">SELECT</span> id <span class="kw">FROM</span> conversations
    <span class="kw">WHERE</span> customer_id = auth.uid()
       <span class="kw">OR</span> dealer_id <span class="kw">IN</span> (
         <span class="kw">SELECT</span> id <span class="kw">FROM</span> dealers
         <span class="kw">WHERE</span> profile_id = auth.uid()
       )
  )
);</pre>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ‚îÄ SECTION 4: REVENUE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section id="revenue">
  <div class="section-header">
    <div class="section-num">04</div>
    <div>
      <h2>Revenue & Commission Flow</h2>
      <p>How you (the app owner) take a cut of every car sale using Stripe Connect</p>
    </div>
  </div>

  <div class="flow container">
    <div class="alert alert-info">üí° The recommended approach is <strong>Stripe Connect</strong> ‚Äî dealers create Connected Accounts, and when a car is sold you use a <strong>Payment Intent</strong> with an application_fee_amount that goes directly to your platform account.</div>

    <div style="margin-top:1.5rem;">
      <div class="flow-row">
        <div class="flow-node" style="border-color: var(--blue);">
          <h4>1. Customer Pays</h4>
          <p>Customer initiates purchase. Pays the full car price via Stripe Payment Intent</p>
          <div class="flow-amount amount-green">$25,000.00 charged</div>
        </div>
        <div class="flow-connector">‚Üí</div>
        <div class="flow-node" style="border-color: var(--accent);">
          <h4>2. Platform Fee Deducted</h4>
          <p>App owner automatically receives their % commission (e.g. 3%) via <code>application_fee_amount</code></p>
          <div class="flow-amount amount-yellow">$750.00 ‚Üí You (platform)</div>
        </div>
        <div class="flow-connector">‚Üí</div>
        <div class="flow-node" style="border-color: var(--green);">
          <h4>3. Dealer Receives Payout</h4>
          <p>Remaining funds are transferred to the dealer's Stripe Connected Account automatically</p>
          <div class="flow-amount amount-green">$24,250.00 ‚Üí Dealer</div>
        </div>
      </div>
    </div>

    <div style="margin-top:1.5rem;">
      <div class="code-block">
        <div class="code-header"><span class="code-lang">dart ‚Äî edge function (supabase)</span></div>
        <pre><span class="cmt">// supabase/functions/create-payment/index.ts</span>
<span class="kw">const</span> stripe = <span class="kw">new</span> <span class="type">Stripe</span>(Deno.env.get(<span class="str">'STRIPE_SECRET_KEY'</span>));

<span class="kw">const</span> { carId, buyerId, dealerStripeAccountId, salePrice } = <span class="kw">await</span> req.json();

<span class="kw">const</span> commissionRate = <span class="num">0.03</span>; <span class="cmt">// 3% ‚Äî adjust per dealer plan</span>
<span class="kw">const</span> appFee = Math.round(salePrice * commissionRate * <span class="num">100</span>); <span class="cmt">// in cents</span>

<span class="kw">const</span> paymentIntent = <span class="kw">await</span> stripe.paymentIntents.create({
  amount: salePrice * <span class="num">100</span>,
  currency: <span class="str">'usd'</span>,
  application_fee_amount: appFee,           <span class="cmt">// ‚Üê your cut</span>
  transfer_data: {
    destination: dealerStripeAccountId,     <span class="cmt">// ‚Üê dealer gets the rest</span>
  },
  metadata: { carId, buyerId },
});

<span class="cmt">// Save transaction to Supabase</span>
<span class="kw">await</span> supabaseAdmin.from(<span class="str">'transactions'</span>).insert({
  car_id: carId,
  buyer_id: buyerId,
  sale_price: salePrice,
  platform_fee: appFee / <span class="num">100</span>,
  dealer_payout: (salePrice * <span class="num">100</span> - appFee) / <span class="num">100</span>,
  stripe_transfer_id: paymentIntent.id,
  status: <span class="str">'pending'</span>,
});

<span class="kw">return</span> <span class="kw">new</span> Response(JSON.stringify({ clientSecret: paymentIntent.client_secret }));</pre>
      </div>
    </div>

    <div class="alert alert-warn" style="margin-top:1rem;">‚ö†Ô∏è Commission rate can vary per subscription plan. Premium dealers pay 2%, Basic dealers pay 5%. Store <code>commission_rate</code> in the <code>dealers</code> table and read it when creating the Payment Intent.</div>
  </div>
</section>

<!-- ‚îÄ‚îÄ‚îÄ SECTION 5: SUBSCRIPTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section id="subscriptions">
  <div class="section-header">
    <div class="section-num">05</div>
    <div>
      <h2>Dealer Subscription Plans</h2>
      <p>Monthly / yearly tiers with different listing limits and commission rates</p>
    </div>
  </div>

  <div class="sub-grid container">
    <div class="sub-card">
      <div class="sub-card-header">
        <div class="sub-plan">Basic</div>
        <div class="sub-price">$29<span class="sub-period">/mo</span></div>
        <div class="sub-period" style="margin-top:0.25rem;">or $290/yr (save 2 months)</div>
      </div>
      <div class="sub-features">
        <div class="sub-feature"><span class="check">‚úì</span> 10 car listings/month</div>
        <div class="sub-feature"><span class="check">‚úì</span> Customer messaging</div>
        <div class="sub-feature"><span class="check">‚úì</span> Basic analytics</div>
        <div class="sub-feature"><span class="x">‚úó</span> Featured listings</div>
        <div class="sub-feature"><span class="x">‚úó</span> Priority support</div>
        <div class="sub-feature" style="color:var(--red);">5% commission per sale</div>
      </div>
    </div>
    <div class="sub-card popular">
      <div class="sub-card-header">
        <div class="popular-badge">Most Popular</div>
        <div class="sub-plan">Professional</div>
        <div class="sub-price">$79<span class="sub-period">/mo</span></div>
        <div class="sub-period" style="margin-top:0.25rem;">or $790/yr (save 2 months)</div>
      </div>
      <div class="sub-features">
        <div class="sub-feature"><span class="check">‚úì</span> 50 car listings/month</div>
        <div class="sub-feature"><span class="check">‚úì</span> Customer messaging</div>
        <div class="sub-feature"><span class="check">‚úì</span> Advanced analytics</div>
        <div class="sub-feature"><span class="check">‚úì</span> Featured listings (5/mo)</div>
        <div class="sub-feature"><span class="x">‚úó</span> Priority support</div>
        <div class="sub-feature" style="color:var(--accent);">3% commission per sale</div>
      </div>
    </div>
    <div class="sub-card">
      <div class="sub-card-header">
        <div class="sub-plan">Enterprise</div>
        <div class="sub-price">$199<span class="sub-period">/mo</span></div>
        <div class="sub-period" style="margin-top:0.25rem;">or $1990/yr (save 2 months)</div>
      </div>
      <div class="sub-features">
        <div class="sub-feature"><span class="check">‚úì</span> Unlimited listings</div>
        <div class="sub-feature"><span class="check">‚úì</span> Customer messaging</div>
        <div class="sub-feature"><span class="check">‚úì</span> Full analytics suite</div>
        <div class="sub-feature"><span class="check">‚úì</span> Unlimited featured listings</div>
        <div class="sub-feature"><span class="check">‚úì</span> Priority support</div>
        <div class="sub-feature" style="color:var(--green);">1.5% commission per sale</div>
      </div>
    </div>
  </div>

  <div class="container" style="margin-top:1.5rem;">
    <div class="code-block">
      <div class="code-header"><span class="code-lang">sql ‚Äî seed subscription plans</span></div>
      <pre><span class="kw">INSERT INTO</span> subscription_plans (name, interval, price, max_listings, commission_rate, stripe_price_id) <span class="kw">VALUES</span>
  (<span class="str">'Basic'</span>,        <span class="str">'monthly'</span>, <span class="num">29.00</span>,   <span class="num">10</span>,    <span class="num">5.00</span>,  <span class="str">'price_basic_monthly'</span>),
  (<span class="str">'Basic'</span>,        <span class="str">'yearly'</span>,  <span class="num">290.00</span>,  <span class="num">10</span>,    <span class="num">5.00</span>,  <span class="str">'price_basic_yearly'</span>),
  (<span class="str">'Professional'</span>, <span class="str">'monthly'</span>, <span class="num">79.00</span>,   <span class="num">50</span>,    <span class="num">3.00</span>,  <span class="str">'price_pro_monthly'</span>),
  (<span class="str">'Professional'</span>, <span class="str">'yearly'</span>,  <span class="num">790.00</span>,  <span class="num">50</span>,    <span class="num">3.00</span>,  <span class="str">'price_pro_yearly'</span>),
  (<span class="str">'Enterprise'</span>,   <span class="str">'monthly'</span>, <span class="num">199.00</span>,  <span class="num">-1</span>,    <span class="num">1.50</span>,  <span class="str">'price_ent_monthly'</span>),
  (<span class="str">'Enterprise'</span>,   <span class="str">'yearly'</span>,  <span class="num">1990.00</span>, <span class="num">-1</span>,    <span class="num">1.50</span>,  <span class="str">'price_ent_yearly'</span>);</pre>
    </div>
  </div>

  <div class="container" style="margin-top:1rem;">
    <div class="code-block">
      <div class="code-header"><span class="code-lang">dart ‚Äî subscribe dealer via edge function</span></div>
      <pre><span class="cmt">// supabase/functions/subscribe-dealer/index.ts</span>
<span class="kw">const</span> { dealerId, stripePriceId } = <span class="kw">await</span> req.json();

<span class="kw">const</span> dealer = <span class="kw">await</span> supabaseAdmin
  .from(<span class="str">'dealers'</span>).select(<span class="str">'stripe_customer_id'</span>).eq(<span class="str">'id'</span>, dealerId).single();

<span class="kw">const</span> subscription = <span class="kw">await</span> stripe.subscriptions.create({
  customer: dealer.stripe_customer_id,
  items: [{ price: stripePriceId }],
  expand: [<span class="str">'latest_invoice.payment_intent'</span>],
});

<span class="cmt">// Upsert into dealer_subscriptions</span>
<span class="kw">await</span> supabaseAdmin.from(<span class="str">'dealer_subscriptions'</span>).upsert({
  dealer_id: dealerId,
  stripe_sub_id: subscription.id,
  status: subscription.status,
  current_period_end: <span class="kw">new</span> Date(subscription.current_period_end * <span class="num">1000</span>).toISOString(),
});</pre>
    </div>
  </div>
</section>

<!-- ‚îÄ‚îÄ‚îÄ SECTION 6: FULL IMPLEMENTATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section id="implementation">
  <div class="section-header">
    <div class="section-num">06</div>
    <div>
      <h2>Step-by-Step Implementation</h2>
      <p>Everything in order, from project setup to production</p>
    </div>
  </div>

  <div class="impl-steps">

    <div class="impl-step">
      <div class="impl-step-num">1</div>
      <div class="impl-step-content">
        <h3>Create Supabase Project & Flutter App</h3>
        <p>Set up both projects and connect them.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">bash</span></div>
          <pre><span class="cmt"># Create Flutter project</span>
flutter create automarket --org com.yourcompany
cd automarket

<span class="cmt"># Add dependencies to pubspec.yaml</span>
flutter pub add supabase_flutter stripe_flutter
flutter pub add flutter_riverpod go_router cached_network_image
flutter pub add image_picker file_picker</pre>
        </div>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">dart ‚Äî main.dart</span></div>
          <pre><span class="kw">void</span> <span class="fn">main</span>() <span class="kw">async</span> {
  WidgetsFlutterBinding.ensureInitialized();
  <span class="kw">await</span> Supabase.initialize(
    url: <span class="str">'YOUR_SUPABASE_URL'</span>,
    anonKey: <span class="str">'YOUR_ANON_KEY'</span>,
  );
  runApp(<span class="kw">const</span> ProviderScope(child: AutoMarketApp()));
}</pre>
        </div>
      </div>
    </div>

    <div class="impl-step">
      <div class="impl-step-num">2</div>
      <div class="impl-step-content">
        <h3>Run SQL Migrations in Supabase</h3>
        <p>Go to Supabase ‚Üí SQL Editor ‚Üí paste and run these scripts to create all tables.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">sql ‚Äî create all tables</span></div>
          <pre><span class="cmt">-- 1. Extend auth.users with a profiles table</span>
<span class="kw">CREATE TABLE</span> profiles (
  id          uuid <span class="kw">REFERENCES</span> auth.users <span class="kw">PRIMARY KEY</span>,
  full_name   text,
  email       text <span class="kw">UNIQUE</span>,
  phone       text,
  avatar_url  text,
  role        text <span class="kw">DEFAULT</span> <span class="str">'customer'</span>
               <span class="kw">CHECK</span> (role <span class="kw">IN</span> (<span class="str">'customer'</span>, <span class="str">'dealer'</span>, <span class="str">'admin'</span>)),
  created_at  timestamptz <span class="kw">DEFAULT</span> now()
);

<span class="cmt">-- Auto-create profile on signup</span>
<span class="kw">CREATE OR REPLACE FUNCTION</span> handle_new_user()
<span class="kw">RETURNS TRIGGER AS</span> $$
<span class="kw">BEGIN</span>
  <span class="kw">INSERT INTO</span> profiles (id, email, full_name)
  <span class="kw">VALUES</span> (new.id, new.email, new.raw_user_meta_data->>><span class="str">'full_name'</span>);
  <span class="kw">RETURN</span> new;
<span class="kw">END</span>;
$$ <span class="kw">LANGUAGE</span> plpgsql security definer;

<span class="kw">CREATE TRIGGER</span> on_auth_user_created
  <span class="kw">AFTER INSERT ON</span> auth.users
  <span class="kw">FOR EACH ROW EXECUTE</span> handle_new_user();

<span class="cmt">-- 2. Dealers</span>
<span class="kw">CREATE TABLE</span> dealers (
  id                uuid <span class="kw">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  profile_id        uuid <span class="kw">REFERENCES</span> profiles <span class="kw">UNIQUE NOT NULL</span>,
  business_name     text <span class="kw">NOT NULL</span>,
  license_number    text <span class="kw">UNIQUE</span>,
  address           text,
  is_verified       bool <span class="kw">DEFAULT</span> <span class="kw">false</span>,
  commission_rate   numeric(<span class="num">5</span>,<span class="num">2</span>) <span class="kw">DEFAULT</span> <span class="num">5.00</span>,
  stripe_account_id text,
  rating            numeric(<span class="num">3</span>,<span class="num">2</span>) <span class="kw">DEFAULT</span> <span class="num">0</span>
);

<span class="cmt">-- 3. Cars</span>
<span class="kw">CREATE TABLE</span> cars (
  id          uuid <span class="kw">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  dealer_id   uuid <span class="kw">REFERENCES</span> dealers <span class="kw">NOT NULL</span>,
  make        text <span class="kw">NOT NULL</span>,
  model       text <span class="kw">NOT NULL</span>,
  year        int  <span class="kw">NOT NULL</span>,
  price       numeric(<span class="num">12</span>,<span class="num">2</span>) <span class="kw">NOT NULL</span>,
  mileage     int,
  condition   text <span class="kw">DEFAULT</span> <span class="str">'used'</span>,
  status      text <span class="kw">DEFAULT</span> <span class="str">'available'</span>,
  images      text[],
  specs       jsonb,
  description text,
  created_at  timestamptz <span class="kw">DEFAULT</span> now()
);</pre>
        </div>
      </div>
    </div>

    <div class="impl-step">
      <div class="impl-step-num">3</div>
      <div class="impl-step-content">
        <h3>Enable Row Level Security on All Tables</h3>
        <p>Protect data so users only access what they own. Enable RLS in Supabase Dashboard ‚Üí Auth ‚Üí Policies, then add these policies.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">sql</span></div>
          <pre><span class="kw">ALTER TABLE</span> profiles      <span class="kw">ENABLE ROW LEVEL SECURITY</span>;
<span class="kw">ALTER TABLE</span> dealers       <span class="kw">ENABLE ROW LEVEL SECURITY</span>;
<span class="kw">ALTER TABLE</span> cars          <span class="kw">ENABLE ROW LEVEL SECURITY</span>;
<span class="kw">ALTER TABLE</span> conversations <span class="kw">ENABLE ROW LEVEL SECURITY</span>;
<span class="kw">ALTER TABLE</span> messages      <span class="kw">ENABLE ROW LEVEL SECURITY</span>;
<span class="kw">ALTER TABLE</span> transactions  <span class="kw">ENABLE ROW LEVEL SECURITY</span>;

<span class="cmt">-- Everyone can read available cars</span>
<span class="kw">CREATE POLICY</span> <span class="str">"cars_read"</span> <span class="kw">ON</span> cars <span class="kw">FOR SELECT USING</span> (<span class="kw">true</span>);

<span class="cmt">-- Only dealer can insert/update their cars</span>
<span class="kw">CREATE POLICY</span> <span class="str">"cars_dealer_write"</span> <span class="kw">ON</span> cars
  <span class="kw">FOR ALL USING</span> (dealer_id <span class="kw">IN</span> (
    <span class="kw">SELECT</span> id <span class="kw">FROM</span> dealers <span class="kw">WHERE</span> profile_id = auth.uid()
  ));

<span class="cmt">-- Users see own profile</span>
<span class="kw">CREATE POLICY</span> <span class="str">"own_profile"</span> <span class="kw">ON</span> profiles
  <span class="kw">FOR ALL USING</span> (id = auth.uid());</pre>
        </div>
      </div>
    </div>

    <div class="impl-step">
      <div class="impl-step-num">4</div>
      <div class="impl-step-content">
        <h3>Set Up Stripe Connect for Dealers</h3>
        <p>When a dealer registers, onboard them to Stripe Connect. They complete a form and get a Connected Account ID that you store in your <code>dealers</code> table.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">typescript ‚Äî edge function</span></div>
          <pre><span class="cmt">// supabase/functions/onboard-dealer/index.ts</span>
<span class="kw">const</span> account = <span class="kw">await</span> stripe.accounts.create({
  type: <span class="str">'express'</span>,
  country: <span class="str">'US'</span>,
  email: dealerEmail,
  capabilities: { card_payments: { requested: <span class="kw">true</span> }, transfers: { requested: <span class="kw">true</span> } },
});

<span class="cmt">// Store on dealer record</span>
<span class="kw">await</span> supabaseAdmin.from(<span class="str">'dealers'</span>)
  .update({ stripe_account_id: account.id })
  .eq(<span class="str">'id'</span>, dealerId);

<span class="cmt">// Get onboarding link to send to dealer</span>
<span class="kw">const</span> accountLink = <span class="kw">await</span> stripe.accountLinks.create({
  account: account.id,
  refresh_url: <span class="str">'https://yourapp.com/reauth'</span>,
  return_url: <span class="str">'https://yourapp.com/onboarded'</span>,
  type: <span class="str">'account_onboarding'</span>,
});

<span class="kw">return</span> <span class="kw">new</span> Response(JSON.stringify({ url: accountLink.url }));</pre>
        </div>
      </div>
    </div>

    <div class="impl-step">
      <div class="impl-step-num">5</div>
      <div class="impl-step-content">
        <h3>Implement Subscription Flow in Flutter</h3>
        <p>Show the plan picker screen when a dealer signs up. Call your edge function to create a Stripe Checkout Session, then open it in a WebView or browser.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">dart</span></div>
          <pre><span class="kw">Future</span>&lt;<span class="kw">void</span>&gt; <span class="fn">subscribeToPlan</span>(<span class="type">String</span> stripePriceId) <span class="kw">async</span> {
  <span class="kw">final</span> response = <span class="kw">await</span> supabase.functions.invoke(
    <span class="str">'create-checkout-session'</span>,
    body: {<span class="str">'price_id'</span>: stripePriceId, <span class="str">'dealer_id'</span>: dealerId},
  );

  <span class="kw">final</span> checkoutUrl = response.data[<span class="str">'url'</span>] <span class="kw">as</span> <span class="type">String</span>;

  <span class="cmt">// Open Stripe Checkout in browser</span>
  <span class="kw">if</span> (<span class="kw">await</span> canLaunchUrl(Uri.parse(checkoutUrl))) {
    <span class="kw">await</span> launchUrl(Uri.parse(checkoutUrl),
      mode: LaunchMode.externalApplication);
  }
}

<span class="cmt">// Listen for webhook to update subscription status</span>
<span class="cmt">// Use Stripe CLI to test: stripe listen --forward-to localhost:54321</span></pre>
        </div>
      </div>
    </div>

    <div class="impl-step">
      <div class="impl-step-num">6</div>
      <div class="impl-step-content">
        <h3>Handle Stripe Webhooks</h3>
        <p>Stripe notifies your app when subscriptions change, renewals happen, payments fail, etc. Handle them in a Supabase Edge Function.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">typescript ‚Äî supabase/functions/stripe-webhook</span></div>
          <pre"><span class="kw">const</span> sig = req.headers.get(<span class="str">'stripe-signature'</span>)!;
<span class="kw">const</span> event = stripe.webhooks.constructEvent(body, sig, webhookSecret);

<span class="kw">switch</span> (event.type) {
  <span class="kw">case</span> <span class="str">'customer.subscription.updated'</span>:
  <span class="kw">case</span> <span class="str">'customer.subscription.deleted'</span>: {
    <span class="kw">const</span> sub = event.data.object;
    <span class="kw">await</span> supabaseAdmin.from(<span class="str">'dealer_subscriptions'</span>)
      .update({ status: sub.status, current_period_end: <span class="kw">new</span> Date(sub.current_period_end * <span class="num">1000</span>) })
      .eq(<span class="str">'stripe_sub_id'</span>, sub.id);

    <span class="cmt">// Update dealer commission rate based on plan</span>
    <span class="kw">const</span> plan = <span class="kw">await</span> supabaseAdmin.from(<span class="str">'subscription_plans'</span>)
      .select(<span class="str">'commission_rate'</span>).eq(<span class="str">'stripe_price_id'</span>, sub.items.data[<span class="num">0</span>].price.id).single();

    <span class="kw">await</span> supabaseAdmin.from(<span class="str">'dealers'</span>)
      .update({ commission_rate: plan.data.commission_rate })
      .eq(<span class="str">'stripe_customer_id'</span>, sub.customer);
    <span class="kw">break</span>;
  }
  <span class="kw">case</span> <span class="str">'payment_intent.succeeded'</span>: {
    <span class="cmt">// Mark car as sold, mark transaction as completed</span>
    <span class="kw">const</span> { carId } = event.data.object.metadata;
    <span class="kw">await</span> supabaseAdmin.from(<span class="str">'cars'</span>).update({ status: <span class="str">'sold'</span> }).eq(<span class="str">'id'</span>, carId);
    <span class="kw">break</span>;
  }
}</pre>
        </div>
      </div>
    </div>

    <div class="impl-step">
      <div class="impl-step-num">7</div>
      <div class="impl-step-content">
        <h3>Flutter App Folder Structure</h3>
        <p>Organize your Flutter project clearly for scalability.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">bash</span></div>
          <pre>lib/
‚îú‚îÄ‚îÄ main.dart
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ supabase_client.dart       <span class="cmt"># Supabase singleton</span>
‚îÇ   ‚îú‚îÄ‚îÄ router.dart                <span class="cmt"># GoRouter routes</span>
‚îÇ   ‚îî‚îÄ‚îÄ theme.dart
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ screens/               <span class="cmt"># login, register, role selection</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers/
‚îÇ   ‚îú‚îÄ‚îÄ cars/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ screens/               <span class="cmt"># listing, detail, add car</span>
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ widgets/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers/
‚îÇ   ‚îú‚îÄ‚îÄ dealers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ screens/               <span class="cmt"># dealer profile, dashboard</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers/
‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ screens/               <span class="cmt"># conversation list, chat screen</span>
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ widgets/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers/
‚îÇ   ‚îú‚îÄ‚îÄ transactions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ screens/               <span class="cmt"># payment, history</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers/
‚îÇ   ‚îî‚îÄ‚îÄ subscriptions/
‚îÇ       ‚îú‚îÄ‚îÄ screens/               <span class="cmt"># plan picker, billing</span>
‚îÇ       ‚îî‚îÄ‚îÄ providers/
‚îú‚îÄ‚îÄ models/                        <span class="cmt"># Car, Dealer, Message, etc.</span>
‚îî‚îÄ‚îÄ shared/
    ‚îú‚îÄ‚îÄ widgets/
    ‚îî‚îÄ‚îÄ utils/</pre>
        </div>
      </div>
    </div>

    <div class="impl-step">
      <div class="impl-step-num">8</div>
      <div class="impl-step-content">
        <h3>Set Up Supabase Storage for Car Images</h3>
        <p>Create a storage bucket for car images, configure RLS on it, and upload from Flutter.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">dart</span></div>
          <pre><span class="kw">Future</span>&lt;<span class="type">String</span>&gt; <span class="fn">uploadCarImage</span>(File imageFile, <span class="type">String</span> carId) <span class="kw">async</span> {
  <span class="kw">final</span> path = <span class="str">'cars/</span><span class="var">$carId</span><span class="str">/</span><span class="var">${DateTime.now().millisecondsSinceEpoch}</span><span class="str">.jpg'</span>;

  <span class="kw">await</span> supabase.storage
    .from(<span class="str">'car-images'</span>)        <span class="cmt">// bucket name</span>
    .upload(path, imageFile,
      fileOptions: <span class="kw">const</span> FileOptions(contentType: <span class="str">'image/jpeg'</span>));

  <span class="kw">return</span> supabase.storage.from(<span class="str">'car-images'</span>).getPublicUrl(path);
}</pre>
        </div>
        <div class="alert alert-success">‚úÖ In Supabase Dashboard: Storage ‚Üí New Bucket ‚Üí "car-images" ‚Üí Public. Add a policy: dealers can upload to their own folder.</div>
      </div>
    </div>

    <div class="impl-step">
      <div class="impl-step-num">9</div>
      <div class="impl-step-content">
        <h3>Admin Dashboard (Owner View)</h3>
        <p>As the app owner, build a simple admin screen to see revenue, manage dealers, and adjust commission rates. Use Supabase's <code>service_role</code> key only in your Edge Functions ‚Äî never in Flutter.</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">sql ‚Äî revenue summary view</span></div>
          <pre><span class="kw">CREATE VIEW</span> admin_revenue_summary <span class="kw">AS</span>
<span class="kw">SELECT</span>
  date_trunc(<span class="str">'month'</span>, created_at)  <span class="kw">AS</span> month,
  <span class="fn">SUM</span>(sale_price)                  <span class="kw">AS</span> total_sales,
  <span class="fn">SUM</span>(platform_fee)               <span class="kw">AS</span> platform_revenue,
  <span class="fn">COUNT</span>(*)                         <span class="kw">AS</span> cars_sold
<span class="kw">FROM</span> transactions
<span class="kw">WHERE</span> status = <span class="str">'completed'</span>
<span class="kw">GROUP BY</span> <span class="num">1</span>
<span class="kw">ORDER BY</span> <span class="num">1</span> <span class="kw">DESC</span>;</pre>
        </div>
      </div>
    </div>

    <div class="impl-step">
      <div class="impl-step-num">10</div>
      <div class="impl-step-content">
        <h3>Push Notifications for Messages</h3>
        <p>Use Supabase Database Webhooks ‚Üí trigger when a message is inserted ‚Üí call an Edge Function ‚Üí send via Firebase Cloud Messaging (FCM).</p>
        <div class="code-block">
          <div class="code-header"><span class="code-lang">bash ‚Äî setup order</span></div>
          <pre><span class="cmt"># 1. Add firebase_messaging to Flutter</span>
flutter pub add firebase_messaging

<span class="cmt"># 2. Store FCM token in profiles table when user logs in</span>
<span class="cmt"># 3. Supabase: Database ‚Üí Webhooks ‚Üí on messages INSERT</span>
<span class="cmt">#    ‚Üí Call Edge Function 'send-push-notification'</span>
<span class="cmt"># 4. Edge function looks up receiver's FCM token</span>
<span class="cmt">#    and calls FCM API to send the notification</span></pre>
        </div>
      </div>
    </div>

  </div><!-- end impl-steps -->
</section>

<!-- ‚îÄ‚îÄ‚îÄ ARCHITECTURE SUMMARY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section>
  <div class="section-header">
    <div class="section-num">07</div>
    <div>
      <h2>Architecture Summary</h2>
      <p>All layers of the system at a glance</p>
    </div>
  </div>
  <div class="arch-row">
    <div class="arch-layer">
      <div class="arch-layer-title">Flutter (Client)</div>
      <div class="arch-item"><span class="arch-dot"></span>Riverpod state management</div>
      <div class="arch-item"><span class="arch-dot"></span>GoRouter navigation</div>
      <div class="arch-item"><span class="arch-dot"></span>Supabase Flutter SDK</div>
      <div class="arch-item"><span class="arch-dot"></span>Stripe Flutter SDK</div>
      <div class="arch-item"><span class="arch-dot"></span>Firebase Messaging (FCM)</div>
      <div class="arch-item"><span class="arch-dot"></span>Cached Network Image</div>
    </div>
    <div class="arch-layer">
      <div class="arch-layer-title">Supabase (Backend)</div>
      <div class="arch-item"><span class="arch-dot"></span>PostgreSQL database</div>
      <div class="arch-item"><span class="arch-dot"></span>Row Level Security</div>
      <div class="arch-item"><span class="arch-dot"></span>Realtime subscriptions</div>
      <div class="arch-item"><span class="arch-dot"></span>Storage (car images)</div>
      <div class="arch-item"><span class="arch-dot"></span>Edge Functions (Deno)</div>
      <div class="arch-item"><span class="arch-dot"></span>Database Webhooks</div>
    </div>
    <div class="arch-layer">
      <div class="arch-layer-title">Third-party Services</div>
      <div class="arch-item"><span class="arch-dot"></span>Stripe Connect (payments)</div>
      <div class="arch-item"><span class="arch-dot"></span>Stripe Billing (subscriptions)</div>
      <div class="arch-item"><span class="arch-dot"></span>Stripe Webhooks</div>
      <div class="arch-item"><span class="arch-dot"></span>Firebase FCM (push notifications)</div>
      <div class="arch-item"><span class="arch-dot"></span>Supabase Auth (identity)</div>
    </div>
  </div>
</section>

<footer>
  AutoMarket Architecture Guide ¬∑ Built for Flutter + Supabase ¬∑ Commission system powered by Stripe Connect
</footer>

</body>
</html>
